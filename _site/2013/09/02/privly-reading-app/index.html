<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      Privly reading app integration and detecting swipe gesture. &middot; Shivam Verma
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/styles.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Shivam Verma" href="/atom.xml">
</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68715317-1', 'auto');
  ga('send', 'pageview');

</script>
  <body>

    <div class="container content">
      <header class="masthead">
        <center>
          <h2 class="masthead-title">
            <a href="http://localhost:4000">Shivam Verma</a>
            <br/>
            
              &nbsp;&nbsp;&nbsp;
             <small> <a href="/index.html">Blog</a> </small>
            
              &nbsp;&nbsp;&nbsp;
             <small> <a href="/portfolio">Portfolio</a> </small>
            
              &nbsp;&nbsp;&nbsp;
             <small> <a href="/about">About</a> </small>
            
              &nbsp;&nbsp;&nbsp;
             <small> <a href="/atom.xml">Feed</a> </small>
            
          </h3>
        </center>

      </header>

      <main>
        <article class="post">
  <h1 class="post-title">Privly reading app integration and detecting swipe gesture.</h1>
  <time datetime="2013-09-02T00:00:00+08:00" class="post-date">02 Sep 2013</time>
  <h3 id="reading-app">Reading App</h3>
<p>The Privly JS reading app helps a user to view the encrypted content behind privly links. We’ve been working to make sure that the same js app can be used on all platforms and have successfully integrated it on android apart from the web application and the <a href="https://addons.mozilla.org/en-us/firefox/addon/privly/">firefox</a> and <a href="https://chrome.google.com/webstore/detail/privly-content-extension/pkokikcdapfpkkkjpdaamjanniaempol">chrome</a> extensions. This makes it really easy to drop in new Encryption Apps across all platforms.</p>

<p>The only major problem that I encountered while integrating the application was loading a Privly URL in the WebView. The links generated by the encryption applications could not be loaded because part of the URL was encoded and part of it wasn’t. It seems that the android webview is not as forgiving as its web counterpart. So I had to encode the whole URL before passing it on to the JS. This required a decoding method on the JS side since the other methods expected the URL to be partially encoded. And this had to be implemented without making any android specific change to the JS.</p>

<p>I added a decodeURIComponent() to the code before passing the URL to other methods but this caused the JS to call the decode method twice on the same URL leading to completely decoded URL ( since parameters.getApplicationURL() was being called twice)  which in turn led to empty parameters being passed around in the application.  Finally, as Sean suggested, I ended up removing one of the calls to parameters.getApplicationURL() as it wasn’t really necessary for the working of the current reading application. Now, we had a partially encoded URL which could be successfully used to fetch the privlyDataURL parameter with the random auth_token.</p>

<p>Here’s a screenshot of the reading app in action!</p>

<p align="center">
    <img class="size-medium wp-image-142 aligncenter" alt="Screenshot_2013-09-02-16-29-04 (1)" src="/assets/blog/screenshot_2013-09-02-16-29-04-1.png?w=180" width="180" height="300" />
</p>

<p>Now, I wanted to load the URLs for the reading app from a SQLite Database. This’ll help in connecting a user’s social / email feed (Planned Feature). Adding a SQLite Db was pretty straight forward. <a href="http://developer.android.com/training/basics/data-storage/databases.html">The Android Developer Website is an exhaustive resource.</a></p>
<h3>Swipe Gesture Detection</h3>
<p>The next feature to be added was swipe to change posts. The Privly URLs were to be fetched from the SQLite Db and move back and forth on right and left swipe. Now, swipe was something that I had never worked on but it was fairly simple. <a href="http://stackoverflow.com/questions/937313/android-basic-gesture-detection">This stackoverflow answer</a> was of great help.</p>

<p>In onCreate() method</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// Setup WebView to detect swipes.</span>
<span class="n">gestureDetector</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GestureDetector</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nf">SwipeGestureDetector</span><span class="o">());</span>
<span class="n">gestureListener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnTouchListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouch</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">,</span> <span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">gestureDetector</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">};</span>
<span class="n">webView</span><span class="o">.</span><span class="na">setOnTouchListener</span><span class="o">(</span><span class="n">gestureListener</span><span class="o">);</span>
<span class="o">[/</span><span class="n">sourcecode</span><span class="o">]</span>

<span class="n">And</span> <span class="n">then</span> <span class="n">we</span> <span class="n">define</span> <span class="n">the</span> <span class="nf">SwipeGestureDector</span><span class="o">()</span> <span class="n">Class</span>

<span class="o">[</span><span class="n">sourcecode</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span><span class="o">]</span>
<span class="kd">class</span> <span class="nc">SwipeGestureDetector</span> <span class="kd">extends</span> <span class="n">SimpleOnGestureListener</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onFling</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">e1</span><span class="o">,</span> <span class="n">MotionEvent</span> <span class="n">e2</span><span class="o">,</span> <span class="kt">float</span> <span class="n">velocityX</span><span class="o">,</span>
    <span class="kt">float</span> <span class="n">velocityY</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Values</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Values</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">());</span>
            <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">valuesForSwipe</span> <span class="o">=</span> <span class="n">values</span>
            <span class="o">.</span><span class="na">getValuesForSwipe</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">e1</span><span class="o">.</span><span class="na">getY</span><span class="o">()</span> <span class="o">-</span> <span class="n">e2</span><span class="o">.</span><span class="na">getY</span><span class="o">())</span> <span class="o">&gt;</span> <span class="n">valuesForSwipe</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;swipeMaxOffPath&quot;</span><span class="o">))</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">e1</span><span class="o">.</span><span class="na">getX</span><span class="o">()</span> <span class="o">-</span> <span class="n">e2</span><span class="o">.</span><span class="na">getX</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">valuesForSwipe</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;swipeMinDistance&quot;</span><span class="o">)</span>
            <span class="o">&amp;&amp;</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">velocityX</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">valuesForSwipe</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;swipeThresholdVelocity&quot;</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">&quot;Left Swipe&quot;</span><span class="o">,</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">e2</span><span class="o">.</span><span class="na">getX</span><span class="o">()</span> <span class="o">-</span> <span class="n">e1</span><span class="o">.</span><span class="na">getX</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">valuesForSwipe</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;swipeMinDistance&quot;</span><span class="o">)</span>
            <span class="o">&amp;&amp;</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">velocityX</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">valuesForSwipe</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;swipeThresholdVelocity&quot;</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">&quot;Right Swipe&quot;</span><span class="o">,</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onDown</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&quot;tag&quot;</span><span class="o">,</span> <span class="s">&quot;onDown: &quot;</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></div>

<p>We can use the ViewConfiguration Class to fetch the optimum values for variables which help us determine the type of gesture.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">swipeValues</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;();</span>
<span class="n">ViewConfiguration</span> <span class="n">vc</span> <span class="o">=</span> <span class="n">ViewConfiguration</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
<span class="n">swipeValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;swipeMinDistance&quot;</span><span class="o">,</span> <span class="n">vc</span><span class="o">.</span><span class="na">getScaledPagingTouchSlop</span><span class="o">());</span>
<span class="n">swipeValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;swipeThresholdVelocity&quot;</span><span class="o">,</span>
<span class="n">vc</span><span class="o">.</span><span class="na">getScaledMinimumFlingVelocity</span><span class="o">());</span>
<span class="n">swipeValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;swipeMaxOffPath&quot;</span><span class="o">,</span> <span class="n">vc</span><span class="o">.</span><span class="na">getScaledMinimumFlingVelocity</span><span class="o">());</span></code></pre></div>

<p>Next, I’ll be working on fetching Privly Links from a user’s social/email feed and pushing it to local db.</p>
<h3>Undergraduate Thesis</h3>
<p>In my Undergrad Thesis I am working on a very interesting problem of Indoor Navigation using smart phones ( where GPS fails!)  Just starting to learn how the sensors work. Hell lot of mathematics. </p>
<h3>Latest privly-android commit</h3>
<p><a href="https://github.com/vshivam/privly-android/tree/1d508671f6732c62d8fc5fafc59f1e55cebd3652">https://github.com/vshivam/privly-android/tree/1d508671f6732c62d8fc5fafc59f1e55cebd3652</a></p>

</article>


<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2015/06/09/compatible-rsa-encryption/">
            Android, JavaScript and Python compatible RSA Encryption.
            <small><time datetime="2015-06-09T00:00:00+08:00">09 Jun 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/06/07/dynamic-jquery-swatch/">
            Dynamically change jQuery Mobile colour swatch.
            <small><time datetime="2015-06-07T00:00:00+08:00">07 Jun 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/02/17/dnssd-python/">
            Multicast DNS Service discovery in python.
            <small><time datetime="2015-02-17T00:00:00+08:00">17 Feb 2015</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
</aside>


        
<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'vshivam';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      </main>

      <footer class="footer">
      <center> 
            <small>
              Made By Shivam Verma. <br/>Powered by Jekyll and 
              Github. Theme adapted from Poole.
            </small>
      </center>
          <!--
          &copy; 
          <time datetime="2015-10-21T16:34:42+08:00">2015</time>. All rights reserved.
          -->
        </small>
      </footer>
    </div>



  </body>
</html>
